<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>架构-数据 - outrunJ笔记</title>
  <meta property="og:title" content="架构-数据 - outrunJ笔记" />
  <meta name="twitter:title" content="架构-数据 - outrunJ笔记" />
  <meta name="description" content="流量 小米论坛 pv 2000w 热门并发300 20k/页面 300k/图片(未压缩) 70k/无图帖子 500k-3M/有图帖子 动态服务器最小带宽: 48Mbps 静态服务器最小带宽: 1440Mbps 实际购买带宽: 800M 带宽费用: 8.7w/month 糗事百科 pv 1000w 热门并发150 10k/页面 70k/图 4图/页 90k-400k/综合页 动态服务器带宽: 12Mbps 静态服务器带宽: 336Mbps  带宽 建议 热门并发1.5倍到2倍购买 价格 静态IP企业宽带 5M 10M 50M 100M 200M 盛大云 华东双线 216/月 396 1836 3636 7236 盛大云 华北BGP 318 618 3018 6018 12018 阿里云 BGP 100/兆/月 5k 1w 2w Amazon EC2 流量计费 $3313 idcexpert.cn 1.5w 10w linkcloud.cn 双线 也可流量计费 168 480 3300 6600  cdn 介绍 流量不大时带宽比cdn便宜, 流量大时cdn便宜。 界限为250Mbps左右，价格在9k/month 价格 50TB/月 100TB/月 阿里云 3.">
  <meta property="og:description" content="流量 小米论坛 pv 2000w 热门并发300 20k/页面 300k/图片(未压缩) 70k/无图帖子 500k-3M/有图帖子 动态服务器最小带宽: 48Mbps 静态服务器最小带宽: 1440Mbps 实际购买带宽: 800M 带宽费用: 8.7w/month 糗事百科 pv 1000w 热门并发150 10k/页面 70k/图 4图/页 90k-400k/综合页 动态服务器带宽: 12Mbps 静态服务器带宽: 336Mbps  带宽 建议 热门并发1.5倍到2倍购买 价格 静态IP企业宽带 5M 10M 50M 100M 200M 盛大云 华东双线 216/月 396 1836 3636 7236 盛大云 华北BGP 318 618 3018 6018 12018 阿里云 BGP 100/兆/月 5k 1w 2w Amazon EC2 流量计费 $3313 idcexpert.cn 1.5w 10w linkcloud.cn 双线 也可流量计费 168 480 3300 6600  cdn 介绍 流量不大时带宽比cdn便宜, 流量大时cdn便宜。 界限为250Mbps左右，价格在9k/month 价格 50TB/月 100TB/月 阿里云 3.">
  <meta name="twitter:description" content="流量 小米论坛 pv 2000w 热门并发300 20k/页面 300k/图片(未压缩) 70k/无图帖子 500k-3M/有图帖子 动态服务器最小带宽: 48Mbps 静态服务器最小带宽: 1440Mbps 实际购买带宽: 800M 带宽费用: 8.7w/month 糗事百科 pv 1000w 热门并发150 10k/页面 70k/图 4图/页 90k-400k/综合页 动态服务器带宽: …">
  <meta name="author" content="outrunJ"/>
  <meta property="og:site_name" content="outrunJ笔记" />
  <meta property="og:url" content="http://shenwenqing.com/series/test/data/" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.49-DEV" />
  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />
  <script src="/js/jquery-3.3.1.min.js"></script>
  <script defer src="/js/fontawesome.js"></script>
</head>

<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="/">outrunJ笔记</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-categories"><a href="/categories/" title="Categories">Categories</a></li>
      <li class="site-navi-item-tags"><a href="/tags/" title="Tags">Tags</a></li>
      <li class="site-navi-item-archives"><a href="/archives/" title="Archives">Archives</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      
      
      <h1 class="article-title">架构-数据</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>October 10, 2018</time></li>
      </ul>
      
      

<h1 id="流量">流量</h1>

<pre><code>小米论坛
        pv 2000w
        热门并发300
        20k/页面
        300k/图片(未压缩)
        70k/无图帖子
        500k-3M/有图帖子

        动态服务器最小带宽: 48Mbps
        静态服务器最小带宽: 1440Mbps
        实际购买带宽: 800M
        带宽费用: 8.7w/month

糗事百科
        pv 1000w
        热门并发150
        10k/页面
        70k/图
        4图/页    
        90k-400k/综合页
        动态服务器带宽: 12Mbps
        静态服务器带宽: 336Mbps
</code></pre>

<h1 id="带宽">带宽</h1>

<pre><code>建议
        热门并发1.5倍到2倍购买
价格
        静态IP企业宽带                                5M                10M        50M        100M        200M
        盛大云 华东双线                        216/月                396        1836        3636        7236
        盛大云 华北BGP                        318                618        3018        6018        12018
        阿里云 BGP                                100/兆/月        5k        1w        2w
        Amazon EC2 流量计费                                                   $3313         
        idcexpert.cn                                                 1.5w                 10w         
        linkcloud.cn 双线 也可流量计费        168        480        3300        6600         
</code></pre>

<h1 id="cdn">cdn</h1>

<pre><code>介绍
        流量不大时带宽比cdn便宜, 流量大时cdn便宜。
        界限为250Mbps左右，价格在9k/month
价格
        50TB/月        100TB/月 
阿里云        3.8w/月        6.9w/月
盛大云        9k/月                1.7w/月
网宿                  
蓝汛                  
</code></pre>

<h1 id="服务">服务</h1>

<pre><code>teamwork
        confluence
        teambition
        basecamp
        jira
        testlink
        shimo
        dropbox
        trello


itsm/erp
        # IT Service Management, 信息技术服务管理
        salesforce
        servicenow
        workday
                # hr平台

pay
        支付宝
        易宝
        财付通

cti
        天润
        云之讯
        容联

report/olap
        palo

idc
        # infomation data corporation 互联网数据中心

cdn
        七牛
ws
        阿里云
        青云
        digital ocean
        vultr
        aws
        Linode
        azure
                # 微软开放平台
        gce
                # google compute engine
        txCloud
                # 云柜，数据存储和计算
        首都在线

paas
        gae
                # google app engine
        sae
                # sina app engine
        heroku

im
        环信
        云片
        jpush
        im
        sms.webchinese.cn
        个推

ops
        docker

safe
        1password

dns
        godaddy
        万网
        dnspod
</code></pre>

<h1 id="压力">压力</h1>

<pre><code>并发
        jetty 2k-3k
        nginx 1w
        lvs 100w
        f5 + lvs 400w-800w
        mysql 1k
        oracle 1.5k-2k
        tomcat 1k

1并发/10在线用户/100注册用户

1用户/20pv

访问时段
        8点 - 23点
        最大访问量为平均值1.7倍

每个html页面20k, 40k/css, 50k/js. css与js会缓存

数据库
        mongodb
                查询
                        4w++/5s                # aurora测

一个进程13M左右
        10g内存787多并发(最早的apache)
一个线程2M内存
        10g内存5120并发

cpu一级缓存取数据: 3个时钟周期(tick)
cpu二级缓存取数据: 14 tick
内存取数据: 250 tick
磁盘取数据: 4100w tick
网络取数据: 24000w tick

负载均衡器
        # 并发在100w - 800w
        深信服
        F5
</code></pre>

<h1 id="优化">优化</h1>

<pre><code>目的
        稳定
        性能
        扩展
        代码清晰
        解耦
        冷热，新旧数据区隔
        成本
结构
        找瓶颈
        去单点
        服务化
        优质业务专门机器
        广播改订阅
        换语言/框架重构
数据库
        连接释放
        减少不必要数据
        索引
        异步化
        分表
                # 垂直 分字段，水平 分记录
                拆微服务直接做
                hash到几张表
                时间分表
                水平分表proxy
                冷热分离
                lookup table
</code></pre>

<h1 id="工具数据">工具数据</h1>

<pre><code>nodejs
        虚拟机数据
                mem: 512m
                mem: 66.7%
                cpu: 1%
        执行
                5秒循环mongo数据: 17w条
        状况
                程序完全阻塞

        并发: 300
        qps: 140
        8核全满

        2-4G 内存 3000万并发
        5w socket                        # 系统最高65535个端口，支持这么多连接
        已实现成就
                ruby迁移到node.js有10倍的性能提升，特定情况下20倍性能提升
                5w并发/min


redis
        200并发, 每次3ms, 37000次/s

mysql
        3.5w写入/s                        # 最多
</code></pre>

    </article>

    
<ul class="article-share">
  <li>
    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </li>
  <li>
    <div class="fb-share-button" data-href="http://shenwenqing.com/series/test/data/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.10";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  </li>
  <li>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <g:plus action="share"></g:plus>
  </li>
  <li>
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label-counter" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
  <li>
    <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
    <script>!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
  </li>
</ul>


    <ul class="pager article-pager">
      <li class="pager-newer">
          <a href="/series/architecture/governance/" data-toggle="tooltip" data-placement="top" title="架构-治理">&lt; Newer</a>
      </li>
      <li class="pager-older">
        <a href="/series/architecture/solution/" data-toggle="tooltip" data-placement="top" title="构架-方案">Older &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer">
  <div class="copyright">&copy; Copyright 2017 outrunJ</div>
  <ul class="site-footer-items">
    <li class="site-footer-item-about"><a href="/about/" title="About">About</a></li>
  </ul>
  <div class="powerdby">
    Powered by <a href="https://gohugo.io/">Hugo</a> and <a href="https://github.com/taikii/whiteplain">Whiteplain</a>
  </div>
</div>
<script src="/js/script.js"></script>
<script src="/js/custom.js"></script>


</body>
</html>
