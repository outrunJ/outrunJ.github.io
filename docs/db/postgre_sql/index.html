<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Postgre SQL | outrun的笔记</title>


<link rel="stylesheet" href="/book.min.6c7317d2e8552a0ac3ea8fd4ba500c3dfb1cc9c74e7afd73eee6d729751fad30.css">


<script defer src="/search.min.ee27cec5adeebb17f8ab96e7260ab73b42d3cfc1dcca73a13fceb99f2ef14cff.js"></script>



<link rel="icon" href="/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://example.com/">outrun的笔记</a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2f docs\2f db\2fpostgre_sql\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/"><strong>介绍</strong></a></li>
<li><a href="/docs/algorithm"><strong>算法</strong></a>

<ul>
<li><a href="/docs/algorithm/math">数学</a></li>
<li><a href="/docs/algorithm/thought">思想</a></li>
<li><a href="/docs/algorithm/data_structure">数据结构</a></li>
</ul></li>
<li><a href="/docs/design"><strong>设计</strong></a>

<ul>
<li><a href="/docs/design/code">代码</a></li>
<li><a href="/docs/design/project">项目</a></li>
</ul></li>
<li><a href="/docs/pl"><strong>程序语言</strong></a>

<ul>
<li><a href="/docs/pl/principle">原理</a></li>
<li><a href="/docs/pl/go">go</a></li>
<li><a href="/docs/pl/js">js</a></li>
<li><a href="/docs/pl/java">java</a></li>
<li><a href="/docs/pl/python">python</a></li>
<li><a href="/docs/pl/haskell">haskell</a></li>
<li><a href="/docs/pl/clojure">clojure</a></li>
<li><a href="/docs/pl/css">css</a></li>
<li><a href="/docs/pl/markup_language"><strong><em>标记语言</em></strong></a>

<ul>
<li><a href="/docs/pl/markup_language/html">html</a></li>
</ul></li>
</ul></li>
<li><a href="/docs/architecture"><strong>架构</strong></a>

<ul>
<li><a href="/docs/architecture/principle">原理</a></li>
<li><a href="/docs/architecture/performance">性能</a></li>
<li><a href="/docs/architecture/solution">方案</a></li>
<li><a href="/docs/architecture/3rd_product">第三方服务</a></li>
<li><a href="/docs/architecture/nginx">nginx</a></li>
<li><a href="/docs/architecture/nodejs">nodejs</a></li>
</ul></li>
<li><a href="/docs/backend"><strong>后端</strong></a>

<ul>
<li><a href="/docs/backend/principle">原理</a></li>
<li><a href="/docs/backend/elasticsearch">elasticsearch</a></li>
<li><a href="/docs/backend/javaweb">javaweb</a></li>
<li><a href="/docs/backend/spring">spring</a></li>
<li><a href="/docs/backend/hibernate">hibernate</a></li>
</ul></li>
<li><a href="/docs/db"><strong>数据库</strong></a>

<ul>
<li><a href="/docs/db/mongodb">mongodb</a></li>
<li><a href="/docs/db/mysql">mysql</a></li>
<li><a href="/docs/db/oracle">oracle</a></li>
<li><a href="/docs/db/postgre_sql">pgsql</a></li>
<li><a href="/docs/db/redis">redis</a></li>
</ul></li>
<li><a href="/docs/frontend"><strong>前端</strong></a>

<ul>
<li><a href="/docs/frontend/jquery">jquery</a></li>
<li><a href="/docs/frontend/bootstrap">bootstrap</a></li>
<li><a href="/docs/frontend/angular">angular</a></li>
<li><a href="/docs/frontend/react">react</a></li>
<li><a href="/docs/frontend/threejs">three.js</a></li>
</ul></li>
<li><a href="/docs/ops"><strong>运维</strong></a>

<ul>
<li><a href="/docs/ops/linux">linux</a></li>
<li><a href="/docs/ops/linux_tool">linux工具</a></li>
<li><a href="/docs/ops/security">安全</a></li>
<li><a href="/docs/ops/docker">docker</a></li>
</ul></li>
<li><a href="/docs/test"><strong>测试</strong></a></li>
<li><a href="/docs/tool"><strong>图形工具</strong></a>

<ul>
<li><a href="/docs/tool/vim">vim</a></li>
<li><a href="/docs/tool/eclipse">eclipse</a></li>
</ul></li>
<li><a href="/docs/method">方法</a></li>
<li><a href="/docs/media">媒体</a></li>
<li><a href="/docs/english">英语</a></li>
<li><a href="/docs/interview">题目</a></li>
<li><a href="/docs/infomation">信息</a></li>
<li><a href="/posts"><strong>博客</strong></a></li>
<li><a href="/about_me">关于我</a></li>
<li><a href="/register">&ldquo;寄存器&rdquo;</a></li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Postgre SQL</strong>
</header>

      
<article class="markdown">

<h1 id="命令">命令</h1>

<pre><code>initdb --locale en_US.UTF-8 -D 'data'
postgres -D data
        # -p 6543
pg_ctl -D data -l a.log start


postmaster
        # -D /data
psql -d postgres
        # 默认创建的数据库，用户名为当前用户名
    ＃ -h localhost -p 5432 -d dbname 用户名 密码
        # -f 导入sql命令文件, 或者在末尾加 &lt; a.sql 来导入
        # -L 导出日志文件
pg_dump -f a.sql -i -C -E UTF8 -n public -h localhost
        # 导出数据库
        # -a 导出某表
createdb
        # -hlocalhost -Upostgres -O 用户名 数据库名                        
        # 创建数据库并指定 owner
dropdb
        # -U user dbname
元命令
        \?
                # postgre命令
        \h
                # sql命令
        \l
                # 列出数据库
        \q
                # 退出
        \c 数据库名
                # 切换数据库
        \du
                # 查看角色
        \dt
                # 查看所有表
        \d tablename
                # 查看表结构
        \i a.sql
                # 执行sql文件
        \o a.log        
                # 日志文件
</code></pre>

<h1 id="特色sql">特色sql</h1>

<pre><code>数据类型
        serial
                # 4字节，自增序列
                bigserial
                        # 8字节
        text default ''::text
        bigint default 0
                # 8字节
                smallint
                        # 2字节
                int, integer
                        # 4字节
                decimal
                        # 变长, 声明精度，精确
                numeric
                        # 同上
                float
                real
                        # 4字节，变精度，不精确
                double precision
                        # 8字节，变精度，不精确

        boolean default false
        text[]
                # text数组
        date
        time
        timestamp with time zone
        interval

        bytea
                # 二进制

        money
        uuid
约束
        constraint user_id primary key (id)
        constraint user_m_id unique(m_id)
        constraint fk_b_id foreign key (b_id) references tbb(id)
                MATCH SIMPLE
                ON UPDATE NO ACTION
                ON DELETE NO ACTION
dcl
        create database db1
                owner outrun
        create role 用户名 with password '密码' login
                # 创建用户。role关键词可以省略
                # 其他权限 : CREATEDB CREATEROLE

        drop database db1
        drop table tablename;

        alter database abc RENAME TO cba;
        alter database 数据库名 owner to 用户名
                # 更改数据库 owner
        alter table tb 
                add primary key (id)
                add foreign key(b_id) references tb(id) on update cascade on delete cascade
                add column c1 text
                alter column id type int using id::integer
                rename c1 to c2
                    drop constraint fk_b_id foreign key (b_id) references tbb(id)
                drop [column] name
                owner to outrun
                        # 更改表 owner

        alter role 用户名 with login
                # 添加权限。其他如 : password 'asdf' 、 VALID UNTIL 'JUL 7 14:00:00 2012 +8' (设置角色有效期)
        alter user postgres with password 'asdf'
                # 修改密码

        grant all privileges on database 数据库名 to 用户名
                # 授权数据库权限
ddl 
        insert into tb(&quot;desc&quot;) values ('a'); 
模糊查询
        ~
                # 匹配正则，大小写相关
                # 除'a$' '^a'的正则都只适合pg_trgm的gin索引
        ~*
                # 匹配正则，大小写无关
        !~
                # 不匹配该正则
        !~*
        ~ '^a'
                like 'a%'
        ~ 'a$'
        ~ 'ab.c'
                like '%ab_c%'
o-&gt; 视图 
CREATE VIEW myview 
AS 
SELECT city, temp_lo, temp_hi, prcp, date, location 
FROM weather, cities 
WHERE city = name;

o-&gt; 建表
create table dwh_timestamp_meta
(
&quot;id&quot; serial NOT NULL,
&quot;id&quot; serial primary key,
&quot;c_id&quot; serial references cities(id),
&quot;mongo_document_name&quot; text default ''::text,
&quot;last_update_time&quot; bigint default 0,
&quot;execute_time&quot; timestamp with time zone,
constraint pk_id primary key(id)
)
with (
oids=false
);

o-&gt; 序列
create table a(
        id integer primary key
);
create sequence a_id_seq
        start with 1
        increment by 1
        no minvalue
        no maxvalue
        cache 1;
alter table a alter column id set default nextval('a_id_seq')
</code></pre>

<h1 id="数据字典">数据字典</h1>

<pre><code>pg_roles
        # 角色信息
pg_database
        # 数据库信息
information_schema
        select column_name from information_schema.columns where table_schema='public' and table_name='ad';
                # 表的所有列名
pg_stat_user_tables
        select relname from pg_stat_user_tables;
                # 所有表名
</code></pre>

<h1 id="配置">配置</h1>

<pre><code>数据库目录
        /usr/lib/systemd/system/postgresql.service
jdbc
        driver : org.postgresql.Driver
    url : jdbc:postgresql://localhost:5432/postgres
    初始用户名 : postgres
    初始数据库 : postgres
</code></pre>

<h1 id="存储过程">存储过程</h1>

<pre><code>drop function change_type1();
create or replace function change_type1()
returns int as
$body$
DECLARE
    r mongo_keys_type%rowtype;
    begin
    for r in select * from mongo_keys_type where type='number'
    loop
        EXECUTE 'alter table &quot;' || r.&quot;mongo_collection_name&quot; || '&quot; alter &quot;' || r.&quot;key&quot; || '&quot; type decimal';
    END LOOP;
    return 0;
    end
$body$
language 'plpgsql';

select change_type1()
</code></pre>
</article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a href="https://github.com/outrunJ/hugo-blog/commit/527b54f06fb1e4192f7f9c86cfded0cda859d1b3" title='Last modified Jun 17, 2019 by shenwenqing' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" alt="Changed" /> Jun 17, 2019
    </a>
  </div>
  
  
  <div>
    <a href="https://github.com/outrunJ/hugo-blog/tree/master/content/docs/db/postgre_sql.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" alt="Edit" /> Edit this page
    </a>
  </div>
  
</div>


      
    </div>

    
  

  <aside class="book-toc level-6 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#命令">命令</a></li>
<li><a href="#特色sql">特色sql</a></li>
<li><a href="#数据字典">数据字典</a></li>
<li><a href="#配置">配置</a></li>
<li><a href="#存储过程">存储过程</a></li>
</ul>
</nav>
  </aside>



  </main>
  
  
  
</body>

</html>
