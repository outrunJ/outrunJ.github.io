<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Ops"><meta property="og:title" content="" />
<meta property="og:description" content="源 163: http://mirrors.163.com/ 阿里云mirror: https://developer.aliyun.com/mirror ubuntu sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list 阿里云maven: https://maven.aliyun.com/mvn/view 阿里云个人docker 入口: cr.console.aliyun.com docker login --username=934260428@qq.com registry.cn-qingdao.aliyuncs.com docker tag java/device:1.0 registry.cn-qingdao.aliyuncs.com/mrs-iot/device:1.0 docker push registry.cn-qingdao.aliyuncs.com/mrs-iot/device:1.0 docker pull registry.cn-qingdao.aliyuncs.com/mrs-iot/device:1.0  linux日志 dmesg journalctl -x # 显示解释 -e # 显示到底部 -u # 指定unit名 --no-pager # 不输出到管道来分页 -f # 追加显示 --user-unit # 指定用户 journalctl -f --user-unit onedrive journalctl -xeu kubelet --no-pager 快捷键 ctrl alt f1/f2/...  命令 envsubst &#39;${THREAD_NUM}&#39; &lt; decoder.conf.template &gt; decoder." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/docs/cache/ops/" />

<title>Ops | outrun的笔记</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.eddc90f1d1267cb826e7cffc53c434e50061c4bfe41146a43670842ce6cb3bf6.css" integrity="sha256-7dyQ8dEmfLgm58/8U8Q05QBhxL/kEUakNnCELObLO/Y=">


<script defer src="/en.search.min.89e277eaffc2d6dc705b9a49befe5b401408d8ab0d73322c720731b5efe7dd95.js" integrity="sha256-ieJ36v/C1txwW5pJvv5bQBQI2KsNczIscgcxte/n3ZU="></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-154152836-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://example.com/"><img src="/logo.png" alt="Logo" /><span>outrun的笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    <ul>
<li><a href="/"><strong>介绍</strong></a></li>
<li><a href="/docs/algorithm"><strong>算法</strong></a>
<ul>
<li><a href="/docs/algorithm/math">数学</a></li>
<li><a href="/docs/algorithm/thought">思想</a></li>
<li><a href="/docs/algorithm/data_structure">数据结构</a></li>
</ul>
</li>
<li><a href="/docs/design"><strong>设计</strong></a>
<ul>
<li><a href="/docs/design/drive">驱动</a></li>
<li><a href="/docs/design/biz">行业</a></li>
<li><a href="/docs/design/organize">组织</a></li>
<li><a href="/docs/design/people">人员</a></li>
<li><a href="/docs/design/project">工程</a></li>
<li><a href="/docs/design/code">代码</a></li>
</ul>
</li>
<li><a href="/docs/pl"><strong>程序语言</strong></a>
<ul>
<li><a href="/docs/pl/principle">原理</a></li>
<li><a href="/docs/pl/go">go</a></li>
<li><a href="/docs/pl/js">js</a></li>
<li><a href="/docs/pl/java">java</a></li>
<li><a href="/docs/pl/python">python</a></li>
<li><a href="/docs/pl/haskell">haskell</a></li>
<li><a href="/docs/pl/clojure">clojure</a></li>
<li><a href="/docs/pl/markup_language"><em><strong>标记语言</strong></em></a>
<ul>
<li><a href="/docs/pl/markup_language/html">html</a></li>
<li><a href="/docs/pl/markup_language/css">css</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/docs/architecture"><strong>架构</strong></a>
<ul>
<li><a href="/docs/architecture/principle">原理</a></li>
<li><a href="/docs/architecture/performance">性能</a></li>
<li><a href="/docs/architecture/solution">方案</a></li>
<li><a href="/docs/architecture/nginx">nginx</a></li>
<li><a href="/docs/architecture/nodejs">nodejs</a></li>
<li><a href="/docs/architecture/spring_cloud">spring cloud</a></li>
</ul>
</li>
<li><a href="/docs/backend"><strong>后端</strong></a>
<ul>
<li><a href="/docs/backend/principle">原理</a></li>
<li><a href="/docs/backend/elasticsearch">elasticsearch</a></li>
<li><a href="/docs/backend/javaweb">javaweb</a></li>
<li><a href="/docs/backend/spring">spring</a></li>
<li><a href="/docs/backend/hibernate">hibernate</a></li>
<li><a href="/docs/backend/hadoop">hadoop</a></li>
</ul>
</li>
<li><a href="/docs/db"><strong>数据库</strong></a>
<ul>
<li><a href="/docs/db/mongodb">mongodb</a></li>
<li><a href="/docs/db/mysql">mysql</a></li>
<li><a href="/docs/db/oracle">oracle</a></li>
<li><a href="/docs/db/postgre_sql">pgsql</a></li>
<li><a href="/docs/db/redis">redis</a></li>
</ul>
</li>
<li><a href="/docs/frontend"><strong>前端</strong></a>
<ul>
<li><a href="/docs/frontend/jquery">jquery</a></li>
<li><a href="/docs/frontend/bootstrap">bootstrap</a></li>
<li><a href="/docs/frontend/angular">angular</a></li>
<li><a href="/docs/frontend/react">react</a></li>
<li><a href="/docs/frontend/threejs">three.js</a></li>
</ul>
</li>
<li><a href="/docs/ops"><strong>运维</strong></a>
<ul>
<li><a href="/docs/ops/linux">linux</a></li>
<li><a href="/docs/ops/tool">工具</a></li>
<li><a href="/docs/ops/security">安全</a></li>
<li><a href="/docs/ops/docker">docker</a></li>
</ul>
</li>
<li><a href="/docs/test"><strong>测试</strong></a></li>
<li><a href="/docs/tool"><strong>图形工具</strong></a>
<ul>
<li><a href="/docs/tool/vim">vim</a></li>
<li><a href="/docs/tool/eclipse">eclipse</a></li>
<li><a href="/docs/tool/apple">apple</a></li>
</ul>
</li>
<li><a href="/docs/misc"><strong>misc</strong></a>
<ul>
<li><a href="/docs/misc/infomation">信息</a></li>
<li><a href="/docs/misc/media">媒体</a></li>
<li><a href="/docs/misc/english">英语</a></li>
<li><a href="/docs/misc/interview">题目</a></li>
</ul>
</li>
<li><a href="/docs/cache"><strong>cache</strong></a>
<ul>
<li><a href="/docs/cache/device">设备</a></li>
<li><a href="/docs/cache/app">app</a></li>
<li><a href="/docs/cache/develop">开发</a></li>
<li><a href="/docs/cache/ops">运维</a></li>
</ul>
</li>
<li><a href="/posts"><strong>博客</strong></a></li>
<li><a href="/about_me">关于我</a></li>
</ul>





</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Ops</strong>
</header>

      
<article class="markdown"><h1 id="heading">源</h1>
<pre><code>163: http://mirrors.163.com/
阿里云mirror: https://developer.aliyun.com/mirror
    ubuntu
        sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list 
阿里云maven: https://maven.aliyun.com/mvn/view
阿里云个人docker
    入口: cr.console.aliyun.com
        docker login --username=934260428@qq.com registry.cn-qingdao.aliyuncs.com
        docker tag java/device:1.0 registry.cn-qingdao.aliyuncs.com/mrs-iot/device:1.0
        docker push registry.cn-qingdao.aliyuncs.com/mrs-iot/device:1.0
        docker pull registry.cn-qingdao.aliyuncs.com/mrs-iot/device:1.0
</code></pre>
<h1 id="linux">linux日志</h1>
<pre><code>dmesg
journalctl
    -x
        # 显示解释
    -e
        # 显示到底部
    -u
        # 指定unit名
    --no-pager
        # 不输出到管道来分页
    -f
        # 追加显示
    --user-unit
        # 指定用户

journalctl -f --user-unit onedrive
journalctl -xeu kubelet --no-pager

快捷键
    ctrl alt f1/f2/...
</code></pre>
<h1 id="heading-1">命令</h1>
<pre><code>envsubst '${THREAD_NUM}' &lt; decoder.conf.template &gt; decoder.conf
grep
    -v grep         # 过滤掉grep

    grep -nr --exclude-dir={.git, res, bin} 'a' .
        # 递归查找
xargs
    -d &quot;\t&quot;         # 定义分隔符
    -t              # -t打印执行的命令
    -L 1            # 1行执行一次
    -n 1            # 一次使用1项
    -I arg1 sh -c 'echo arg1; mkdir arg1'       
        # 执行多命令
    --max-procs 0   # 并行执行，不限数量
awk
    awk '{print $1}'
sed
    sed -i '1i\new line'
        # 第一行前插入
nmap
    nmap 192.168.100.1/24
onedrive
    systemctl --user enable onedrive
    systemctl --user start onedrive
    journalctl --user-unit onedrive -f

    onedrive --resync
su
    切换登录
        sudo -i su outrun
simplehttp
    python -m SimpleHTTPServer 8080
后台
    fg
    bg
    nohup
        nohup *** &gt; /dev/null 2&gt;&amp;1 &amp; 
    ^z
    ^c
    &amp;
    jobs
组合
    kill进程
        ps -ef|grep -v &quot;grep&quot;|grep aurora/app.js |awk '{print $2}'| xargs kill -9
    复制多个
        ls -rt | tail -4 | xargs -i cp -r {} ~/sdb/work/ryxWork/架构/
    替换文本
        sed -i &quot;s/a/b/g&quot; `grep -rl &quot;a&quot; ./`
    代码行数
        find -name &quot;*.go&quot; -or -name &quot;*.py&quot; |xargs grep -v &quot;^$&quot; |wc -l
    unzip中转码
        unzip -P “$(echo 中文 | iconv -f utf-8 -t gbk)”
    爬网站
        wget -x -P curSite -r -l 100 -k -L -np http://nodeapi.ucdok.com/api/
        带cookie
            wget --post-data=&quot;username=u1&amp;password=asdf&quot; --save-cookies=cookie --keep-session-cookies &quot;http://www.abc.com/logging.php&quot;
            wget -x -P curSite -r -l 1 -k -L -np --load-cookies=cookie --keep-session-cookies &quot;https://www.abc.com/display/1&quot;
</code></pre>
<h1 id="maven">maven</h1>
<pre><code>mvn clean package -DskipTests
maven
    maven helper plugin
    打包main方法jar不能引用
    用父项目mvn package, 如果用子项目mvn package会找不到其它子项目(not exist)
    模块运行前mvn package
</code></pre>
<h1 id="docker">docker</h1>
<pre><code>系统
    sudo systemctl daemon-reload
    sudo systemctl restart docker
    docker build --help
registry
    docker login -u outrun -p asdf registry:5000
    curl --user outrun:asdf -X GET  registry:5000/v2/_catalog
        # 列表
    curl --user outrun:asdf -X GET  registry:5000/v2/ubuntu/tags/list
        # tags
    curl --user outrun:asdf -X GET  registry:5000/v2/ubuntu/manifests/latest
        # tag
    curl --user outrun:asdf -X GET -v --silent -H &quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot; registry:5000/v2/ubuntu/manifests/latest 2&gt;&amp;1 | grep Docker-Content-Digest | awk '{print ($3)}'
        # digest
    curl --user outrun:asdf -X DELETE -v --silent -H &quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot; registry:5000/v2/ubuntu/manifests/sha256:134c7fe821b9d359490cd009ce7ca322453f4f2d018623f849e580a89a685e5d
        # 删除
    docker exec -it 4ebff4cdc646 /bin/registry garbage-collect  /etc/docker/registry/config.yml
        # 删除后, 运行垃圾回收
镜像
    镜像文档: https://hub.docker.com/r/ivdata/snapserver/
    docker build -t java/gateway:1.0 .
    docker images
    docker image inspect 4de
    docker images|grep none|awk '{print $3}'|xargs docker rmi -f
        # 删除none镜像
容器
    docker
        run
            --user root
            --name a
            --privileged
            -v
    docker status 45370         # 显示资源占用
    docker inspect 45370        # 详情

    docker run --name gateway --rm -d java/gateway:1.0
    docker run -it ubuntu

    docker exec -it -u root ef2 /bin/bash
    docker restart ef2
    docker logs -f -t ef2
</code></pre>
<h1 id="snap">snap</h1>
<h1 id="brew">brew</h1>
<pre><code>安装：/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install
目录: /usr/local/Homebrew
命令
    brew
        update              # 更新brew
        search
        install
        remove
        upgrade
        tap                 # 安装扩展
        options             # 查看安装选项
        info
        home                # 访问包官网
        services
            list            # 查看已安装
            cleanup         # 清除无用配置
            restart         # 重启
</code></pre>
<h1 id="ubuntu">ubuntu</h1>
<pre><code>apt-cache madison nginx     # 查看仓库中所有版本
</code></pre>
<h1 id="centos">centos</h1>
<pre><code>yum install epel-release
gcc升级
    yum -y install centos-release-scl
    yum -y install devtoolset-6-gcc devtoolset-6-gcc-c++ devtoolset-6-binutils
    scl enable devtoolset-6 bash
    echo &quot;source /opt/rh/devtoolset-6/enable&quot; &gt;&gt;/etc/profile
dnf install @development-tools
snap info mosquitto         # 查看仓库所有版本
</code></pre>
<h1 id="git">git</h1>
<pre><code>tag
    git tag -a v1.0.1  -m 'a' e67 
</code></pre>
<h1 id="kubenetes">kubenetes</h1>
<h2 id="minikube">minikube</h2>
<pre><code>docker login --username=934260428@qq.com registry.cn-hangzhou.aliyuncs.com
命令
    minikube
        start --vm-driver=virtualbox \
            --memory=4096 \
            --cpus=2 \
            --log_dir=/home/outrun/logs \
            --insecure-registry=192.168.99.1:5000 \
            --insecure-registry=registry.cn-qingdao.aliyuncs.com \
            --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers

            --kubernetes-version v1.17.0
            --docker-env=HTTP_PROXY=$HTTP_PROXY \
            --docker-env=HTTPS_PROXY=$HTTPS_PROXY \
            --docker-env=NO_PROXY=$NO_PROXY \
            --image-mirror-country=cn \
            --registry-mirror=https://registry.docker-cn.com \
            --extra-config=kubelet.MaxPods=5.
                # registry一定是minikube容器ip, 可用ifconfig查看
                # --insecure-registry修改需要minikube delete
        stop
        delete
        status 
        docker-env
        ip      # 得到单机集群ip
        service  -n iot mosquitto --url
            # 得到service的nodePort

        ssh
        dashboard
        addons
            list
            enable heapster
            enable ingress
服务
    kube-system
        coredns
        etcd-minikube
        kube-addon-manager-minikube
        kube-proxy
        kube-scheduler-minikube
        nginx-ingress-controller
        storage-provisioner
    kubernetes-dashboard
        dashboard-metrics-scraper
        kubernetes-dashboard
</code></pre>
<h2 id="kubeadm">kubeadm</h2>
<pre><code>kubeadm init
</code></pre>
<h2 id="kubectl">kubectl</h2>
<pre><code>配置
    envsubst &lt; iot.yml |kubectl apply -f -

全局参数
    --output=&quot;jsonpath={.data.\.dockerconfigjson}&quot;
    --output=yaml
    --context=iot
    --namespace=iot 
    --all-namespaces=true
    -n
        # namespace
Basic Commands (Beginner):
    create
        -f y1.yml
    expose
        deployment deploy1
            --target-port=8080
            --type=NodePort
    run   
        run deploy1 --image=gcr.io/google-samples/hello-app:1.0
        --port=8080
    set   
        image deploy gateway *=registry.cn-qingdao.aliyuncs.com/mrs-iot/gateway:1.0

Basic Commands (Intermediate):
    explain
    get
        -o 
            # 格式
            yaml
            wide
        -l app=a1
        -c gateway
        --show-labels
        --selector app=a1
        --all-containers=true
    edit
        ingress iot-ingress
    delete 
        --force  
        --grace-period=0

Deploy Commands:
    rollout
    scale
        deployment nginx-deployment
            --replicas=1
    autoscale
        deployment nginx-deployment 
            --min=2 --max=10 --cpu-percent=80

Cluster Management Commands:
    certificate  
    cluster-info 
    top          
    cordon       
    uncordon     
    drain        
    taint        

Troubleshooting and Debugging Commands:
    describe     
    logs
        -f
        --since=5m
    attach       
    exec         
        -it device-7b8965d85d-xz4qm bash
        -it device-7b8965d85d-xz4qm --container device -- /bin/bash
    port-forward 
    proxy        
        --port=8080
        http://localhost:8080/api/v1/proxy/namespaces/iot/services/device:http/
            # 访问内部端口
    cp           
    auth         

Advanced Commands:
    diff      
    apply           # 升级
        -f y1.yml
    patch     
    replace   
    wait      
    convert   
    kustomize 

Settings Commands:
    label     
    annotate  
    completion

Other Commands:
    api-resources 
    api-versions  
    config        
        view
        current-context
        set-context $(kubectl config current-context) --namespace=iot
        use-context iot

    plugin        
    version       

方案
    连阿里云k8s
        kubectl config set-cluster mrs --server=https://106.14.49.217:6443 --certificate-authority=/home/outrun/scripts/work/mrs-k8s/crt --embed-certs=true
        kubectl config set-context 297351062922226746-cdf45d630b2284f8ab79bea186c161d9f --cluster=mrs --user=297351062922226746 --namespace=lora-app
        kubectl config use-context 297351062922226746-cdf45d630b2284f8ab79bea186c161d9f
        kubectl config set-credentials 297351062922226746  --user=297351062922226746 --client-key=/home/outrun/scripts/work/mrs-k8s/297351062922226746.key.pem --client-certificate=/home/outrun/scripts/work/mrs-k8s/297351062922226746.crt --embed-certs=true
    私有仓库
        kubectl delete secret local
        kubectl -n iot create secret docker-registry local1 \
        --docker-server=192.168.99.1:5000 \
        --docker-username=outrun \
        --docker-password=asdf \
        --docker-email=934260428@qq.com
    所有nodeport
        kubectl get svc --all-namespaces -o go-template='{{range .items}}{{range.spec.ports}}{{if .nodePort}}{{.nodePort}}{{&quot;\n&quot;}}{{end}}{{end}}{{end}}'
</code></pre>
<h2 id="chrome">chrome</h2>
<pre><code>chrome://net-internals/#dns
</code></pre>
</article>

      <div class="book-footer justify-between">
  

  
  
  <div>
    
    <a class="flex align-center" href="https://github.com/outrunJ/hugo-blog/commit/adc0cf7ce98f30a58eff2eafe7af92f6382f0df9" title='Last modified by shenwenqing | Feb 7, 2020' target="_blank">
      <img src="/svg/calendar.svg" alt="Calendar" />
      <span>Feb 7, 2020</span>
    </a>
  </div>
  
  

  
  <div>
    <a class="flex align-center" href="https://github.com/outrunJ/hugo-blog/tree/master/content/docs/cache/ops.md" target="_blank">
      <img src="/svg/edit.svg" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>
  

</div>

      
    </div>

    
  

  <aside class="book-toc levels-6 fixed">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#heading">源</a></li>
    <li><a href="#linux">linux日志</a></li>
    <li><a href="#heading-1">命令</a></li>
    <li><a href="#maven">maven</a></li>
    <li><a href="#docker">docker</a></li>
    <li><a href="#snap">snap</a></li>
    <li><a href="#brew">brew</a></li>
    <li><a href="#ubuntu">ubuntu</a></li>
    <li><a href="#centos">centos</a></li>
    <li><a href="#git">git</a></li>
    <li><a href="#kubenetes">kubenetes</a>
      <ul>
        <li><a href="#minikube">minikube</a></li>
        <li><a href="#kubeadm">kubeadm</a></li>
        <li><a href="#kubectl">kubectl</a></li>
        <li><a href="#chrome">chrome</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>



  </main>

  
</body>

</html>
